<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FFmpeg Stream Recorder</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
            max-width: 600px;
        }
        label {
            font-weight: bold;
        }
        input, button {
            display: block;
            width: 100%;
            margin: 10px 0;
            padding: 8px;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>

    <h2>FFmpeg Stream Recorder</h2>
    <form id="ffmpeg-form">
        <label for="stream_url">Stream URL:</label>
        <input type="text" id="stream_url" required>

        <label for="duration">Total Recording Time (seconds):</label>
        <input type="number" id="duration" required>

        <label for="chunk_length">Chunk Length (seconds):</label>
        <input type="number" id="chunk_length" required>

        <label for="fade_duration">Fade In/Out Duration (seconds):</label>
        <input type="number" id="fade_duration" required>

        <button type="button" onclick="generateScript()">Generate Script</button>
    </form>

    <h3>Generated Batch Script:</h3>
    <pre id="script-output"></pre>
    <button onclick="downloadScript()">Download Script</button>

    <script>
        function generateScript() {
            const streamUrl = document.getElementById("stream_url").value;
            const duration = document.getElementById("duration").value;
            const chunkLength = document.getElementById("chunk_length").value;
            const fadeDuration = document.getElementById("fade_duration").value;

            const script = `@echo off
setlocal enabledelayedexpansion

:: Define variables
set "STREAM_URL=${streamUrl}"
set "DURATION=${duration}"
set "CHUNK_LENGTH=${chunkLength}"
set "FADE_DURATION=${fadeDuration}"
set "OUTPUT_DIR=chunks"
set "OUTPUT_FILE=chunk_"

:: Create output directory
if not exist "%OUTPUT_DIR%" (
    mkdir "%OUTPUT_DIR%"
)

:: Start recording
echo Recording Stream...
ffmpeg -y -i "%STREAM_URL%" -t %DURATION% -c copy "full_record.mp3"
if %errorlevel% neq 0 (
    echo Error recording stream.
    exit /b 1
)

:: Split into chunks and apply fade effects
echo Splitting and Adding Fade Effects...
set /a "num_chunks=%DURATION% / %CHUNK_LENGTH%"
for /L %%i in (0,1,%num_chunks%) do (
    set /a "start_time=%%i * %CHUNK_LENGTH%"
    set "output_file=%OUTPUT_DIR%\\%OUTPUT_FILE%%%i.mp3"
    ffmpeg -y -i "full_record.mp3" -ss !start_time! -t %CHUNK_LENGTH% -af "afade=t=in:st=0:d=%FADE_DURATION%,afade=t=out:st=%CHUNK_LENGTH%-%FADE_DURATION%:d=%FADE_DURATION%" "!output_file!"
    if %errorlevel% neq 0 (
        echo Error processing chunk %%i.
        exit /b 1
    )
)

echo Process completed successfully.
exit /b 0`;

            document.getElementById("script-output").innerText = script;
        }

        function downloadScript() {
            const scriptContent = document.getElementById("script-output").innerText;
            const blob = new Blob([scriptContent], { type: "text/plain" });
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = "ffmpeg_script.bat";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>

</body>
</html>
