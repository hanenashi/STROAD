<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FFmpeg Stream Recorder</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
            max-width: 600px;
        }
        label {
            font-weight: bold;
        }
        input, button {
            display: block;
            width: 100%;
            margin: 10px 0;
            padding: 8px;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>

    <h2>FFmpeg Stream Recorder</h2>
    <form id="ffmpeg-form">
        <label for="stream_url">Stream URL:</label>
        <input type="text" id="stream_url" value="https://live.amperwave.net/direct/ppm-jazz24mp3-ibc1" required>

        <label for="duration">Total Recording Time (seconds):</label>
        <input type="number" id="duration" required>

        <label for="chunk_length">Chunk Length (seconds):</label>
        <input type="number" id="chunk_length" required>

        <button type="button" onclick="generateScript()">Generate Script</button>
    </form>

    <h3>Generated Batch Script:</h3>
    <pre id="script-output"></pre>
    <button onclick="downloadScript()">Download Script</button>

    <script>
        function generateScript() {
            const streamUrl = document.getElementById("stream_url").value;
            const duration = document.getElementById("duration").value;
            const chunkLength = document.getElementById("chunk_length").value;

            const script = `@echo off

rem Set the stream URL
set STREAM_URL=${streamUrl}

rem Set the download time (in seconds) and chunk duration (in seconds)
set DOWNLOAD_TIME=${duration}
set CHUNK_DURATION=${chunkLength}

rem Step 1: Download the stream and split into chunks
echo Recording stream for %DOWNLOAD_TIME% seconds...
ffmpeg -i %STREAM_URL% -t %DOWNLOAD_TIME% -c copy temp_stream.mp3

rem Split the downloaded stream into chunks
echo Splitting the recorded stream into %CHUNK_DURATION%-second chunks...
ffmpeg -i temp_stream.mp3 -f segment -segment_time %CHUNK_DURATION% -c copy chunk%%03d.mp3

rem Step 2: Apply fade-in and fade-out to each chunk
echo Applying fade-in and fade-out to each chunk...
FOR %%A IN (chunk*.mp3) DO (
    ffmpeg -i %%A -filter_complex "afade=d=2, areverse, afade=d=2, areverse" "%%~dpnA_NEW.mp3"
    del %%A
)

rem Clean up the temporary file
del temp_stream.mp3
echo Done!`;

            document.getElementById("script-output").innerText = script;
        }

        function downloadScript() {
            const scriptContent = document.getElementById("script-output").innerText;
            const blob = new Blob([scriptContent], { type: "text/plain" });
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = "ffmpeg_script.bat";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>

</body>
</html>