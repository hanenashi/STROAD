<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FFmpeg Stream Recorder</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
            max-width: 600px;
        }
        label {
            font-weight: bold;
        }
        input, button, textarea {
            display: block;
            width: 100%;
            margin: 10px 0;
            padding: 8px;
        }
        textarea {
            height: 300px;
            resize: vertical;
        }
    </style>
</head>
<body>

    <h2>FFmpeg Stream Recorder</h2>

    <form id="ffmpeg-form">
        <label for="stream_url">Stream URL:</label>
        <input type="text" id="stream_url" value="https://live.amperwave.net/direct/ppm-jazz24mp3-ibc1" required>

        <label for="duration">Total Recording Time (e.g., 1h 20m 40s):</label>
        <input type="text" id="duration" required>

        <label for="chunk_length">Chunk Length (e.g., 1h 20m 40s):</label>
        <input type="text" id="chunk_length" required>

        <label for="fade_duration">Fade In/Out Duration (seconds):</label>
        <input type="number" id="fade_duration" required>

        <label>Choose OS:</label>
        <input type="checkbox" id="win_checkbox" onclick="toggleOS('win')"> Windows
        <input type="checkbox" id="mac_checkbox" onclick="toggleOS('mac')"> MacOS

        <button type="button" onclick="generateScript()">Generate Script</button>
    </form>

    <h3>Generated Script:</h3>
    <textarea id="script-output"></textarea>
    <button onclick="downloadScript()">Download Script</button>

    <script>
        let selectedOS = "win"; // Default to Windows

        function toggleOS(os) {
            if (os === "win") {
                document.getElementById("win_checkbox").checked = true;
                document.getElementById("mac_checkbox").checked = false;
                selectedOS = "win";
            } else {
                document.getElementById("win_checkbox").checked = false;
                document.getElementById("mac_checkbox").checked = true;
                selectedOS = "mac";
            }
        }

        function parseDuration(duration) {
            const regex = /(\d+h)?\s*(\d+m)?\s*(\d+s)?/;
            const matches = duration.match(regex);
            let totalSeconds = 0;

            if (matches[1]) totalSeconds += parseInt(matches[1]) * 3600;
            if (matches[2]) totalSeconds += parseInt(matches[2]) * 60;
            if (matches[3]) totalSeconds += parseInt(matches[3]);

            return totalSeconds;
        }

        function generateScript() {
            const streamUrl = document.getElementById("stream_url").value;
            const duration = parseDuration(document.getElementById("duration").value);
            const chunkLength = parseDuration(document.getElementById("chunk_length").value);
            const fadeDuration = document.getElementById("fade_duration").value;

            let script = "";

            if (selectedOS === "win") {
                script = `@echo off

rem Step 1: Download the stream and split into chunks
echo Recording stream for ${duration} seconds...
ffmpeg -thread_queue_size 512 -i "${streamUrl}" -t ${duration} -c copy temp_stream.mp3

rem Split the downloaded stream into ${chunkLength}-second chunks...
echo Splitting the recorded stream into ${chunkLength}-second chunks...
ffmpeg -thread_queue_size 512 -i temp_stream.mp3 -f segment -segment_time ${chunkLength} -c copy jazz%%03d.mp3

rem Step 2: Apply fade-in and fade-out to each chunk
echo Applying fade-in and fade-out to each chunk...
FOR %%A IN (jazz*.mp3) DO (
    ffmpeg -i "%%A" -filter_complex "afade=d=${fadeDuration}, areverse, afade=d=${fadeDuration}, areverse" -thread_queue_size 512 "%%~dpnA_NEW.mp3"
    del "%%A"
)

rem Clean up the temporary file
del temp_stream.mp3
echo Done!`;
            } else {
                script = `#!/bin/bash

# Step 1: Download the stream and split into chunks
echo "Recording stream for ${duration} seconds..."
ffmpeg -thread_queue_size 512 -i "${streamUrl}" -t ${duration} -c copy temp_stream.mp3

# Split the downloaded stream into ${chunkLength}-second chunks
echo "Splitting the recorded stream into ${chunkLength}-second chunks..."
ffmpeg -thread_queue_size 512 -i temp_stream.mp3 -f segment -segment_time ${chunkLength} -c copy jazz%03d.mp3

# Step 2: Apply fade-in and fade-out to each chunk
echo "Applying fade-in and fade-out to each chunk..."
for file in jazz*.mp3; do
    ffmpeg -i "$file" -filter_complex "afade=d=${fadeDuration}, areverse, afade=d=${fadeDuration}, areverse" -thread_queue_size 512 "${file%.*}_NEW.mp3"
    rm "$file"
done

# Clean up the temporary file
rm temp_stream.mp3
echo "Done!"`;
            }

            document.getElementById("script-output").value = script;
        }

        function downloadScript() {
            const scriptContent = document.getElementById("script-output").value;
            const blob = new Blob([scriptContent], { type: "text/plain" });
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = selectedOS === "win" ? "ffmpeg_script.bat" : "ffmpeg_script.sh";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>

</body>
</html>
