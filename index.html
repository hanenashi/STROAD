<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FFmpeg Stream Recorder</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
            max-width: 600px;
        }
        label {
            font-weight: bold;
        }
        input, button {
            display: block;
            width: 100%;
            margin: 10px 0;
            padding: 8px;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>

    <h2>FFmpeg Stream Recorder</h2>
    <form id="ffmpeg-form">
        <label for="stream_url">Stream URL:</label>
        <input type="text" id="stream_url" required>

        <label for="duration">Total Recording Time (seconds):</label>
        <input type="number" id="duration" required>

        <label for="chunk_length">Chunk Length (seconds):</label>
        <input type="number" id="chunk_length" required>

        <label for="fade_duration">Fade In/Out Duration (seconds):</label>
        <input type="number" id="fade_duration" required>

        <button type="button" onclick="generateScript()">Generate Script</button>
    </form>

    <h3>Generated Batch Script:</h3>
    <pre id="script-output"></pre>
    <button onclick="downloadScript()">Download Script</button>

    <script>
        function generateScript() {
            const streamUrl = document.getElementById("stream_url").value;
            const duration = document.getElementById("duration").value;
            const chunkLength = document.getElementById("chunk_length").value;
            const fadeDuration = document.getElementById("fade_duration").value;

            const script = `@echo off
setlocal enabledelayedexpansion

:: Define variables
set "FFMPEG_URL=https://www.gyan.dev/ffmpeg/builds/packages/ffmpeg-latest-full_build.zip"
set "FFMPEG_DIR=ffmpeg"
set "FFMPEG_EXE=%FFMPEG_DIR%\\bin\\ffmpeg.exe"
set "STREAM_URL=${streamUrl}"
set "OUTPUT_FILE=full_record.mp3"
set "DURATION=${duration}"
set "CHUNK_LENGTH=${chunkLength}"
set "FADE_DURATION=${fadeDuration}"

:: Check if FFmpeg is installed
if not exist "%FFMPEG_EXE%" (
    echo Downloading and extracting FFmpeg...
    powershell -Command "(New-Object Net.WebClient).DownloadFile('%FFMPEG_URL%', 'ffmpeg.zip')"
    powershell -Command "Expand-Archive -Path 'ffmpeg.zip' -DestinationPath '%FFMPEG_DIR%' -Force"
) else (
    echo FFmpeg already installed.
)

:: Start recording
echo Recording Stream...
"%FFMPEG_EXE%" -y -i "%STREAM_URL%" -t %DURATION% -c copy "%OUTPUT_FILE%"
if %errorlevel% neq 0 (
    echo Error recording stream.
    exit /b 1
)

:: Split and apply fade effects
echo Splitting and Adding Fade Effects...
set /a "fade_start=%CHUNK_LENGTH% - %FADE_DURATION%"

"%FFMPEG_EXE%" -y -i "%OUTPUT_FILE%" -af "afade=t=in:st=0:d=%FADE_DURATION%,afade=t=out:st=%fade_start%:d=%FADE_DURATION%" "output_with_fade.mp3"
if %errorlevel% neq 0 (
    echo Error processing fade effect.
    exit /b 1
)

echo Process completed successfully.
exit /b 0`;

            document.getElementById("script-output").innerText = script;
        }

        function downloadScript() {
            const scriptContent = document.getElementById("script-output").innerText;
            const blob = new Blob([scriptContent], { type: "text/plain" });
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = "ffmpeg_script.bat";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>

</body>
</html>
